<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title> Build PC - 3TD SHOP </title>
    <link rel="icon" type="image/png" href="Image_Showroom/Slogan_w_logo.png">
    <!-- ✅ BOOTSTRAP CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- ✅ FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">

    <!-- ✅ Boxicons -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

    <!-- ✅ Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Audiowide&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="HTML/Style/common.css">
    <link rel="stylesheet" href="HTML/Style/resetbuildPC.css">
    <link rel="stylesheet" href="HTML/Style/resetChatbox.css">
    <script>
        window.API_BASE = "https://fn-web.onrender.com";
    </script>
    <script src="Script/js_authsync.js" defer></script>
    <script src="Script/js_cartcount.js" defer></script>
    <script src="Script/js_ordercount.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="Script/js_header.js"></script>
    <script src="Script/js_resetbuildPC.js" defer></script>

</head>
<body>
<!-- Header -->
<div id="header-container"></div>

<!-- Nội dung chính -->
<main class="pc-builder-wrapper">
    <div class="pc-builder" id="pc-builder">
        <!-- Sidebar categories -->
        <aside class="builder-categories">
            <h2 class="builder-title">Danh mục</h2>
            <ul id="category-list"></ul>
            <div class="persist-actions">
          
            </div>
        </aside>

        <!-- Config table -->
        <section class="builder-config">
            <!-- Hàng tiêu đề + Select gợi ý cấu hình -->
            <div class="builder-header">
                <h2 class="builder-title">Tự Build PC</h2>
                <div class="builder-preset">
                    <label for="preset-select" class="visually-hidden">Gợi ý cấu hình</label>
                    <select id="preset-select" class="preset-select" aria-label="Gợi ý cấu hình">
                        <option value="">Gợi ý cấu hình</option>
                        <option value="office">Văn phòng</option>
                        <option value="gaming">Gaming</option>
                        <option value="design">Thiết kế</option>
                        <option value="video">Video</option>
                    </select>
                </div>
            </div>

            <div style="display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap;"></div>
            <div class="compatibility-status" id="compat-status"></div>

            <table class="config-table">
                <thead>
                <tr>
                    <th>Hạng mục</th>
                    <th>Chọn linh kiện</th>
                    <th>Giá</th>
                    <th></th>
                </tr>
                </thead>
                <tbody id="config-rows"></tbody>
                <tfoot>
                <tr class="total-row">
                    <td colspan="2">Tổng cộng</td>
                    <td id="total-price">0₫</td>
                    <td></td>
                </tr>
                </tfoot>
            </table>

            <div class="export-actions">
                <button class="btn neon-btn" id="export-json"><i class="fa fa-shopping-cart"></i> Thêm vào giỏ hàng</button>
                <button class="btn neon-btn alt" id="clear-config"><i class="fa fa-trash"></i> Xóa hết</button>
            </div>
        </section>


        <!-- Summary / Recommendation -->
        <aside class="builder-summary">
            <h2 class="builder-title">Tóm tắt</h2>
            <div id="summary-list" class="summary-list"></div>
            <div class="warning-box" id="warning-box" style="display:none"></div>
            <div class="recommend-box" id="recommend-box"></div>
        </aside>
    </div>
</main>

<!-- Modal chọn linh kiện -->
<div class="builder-modal" id="part-modal" style="display:none;">
  <div class="builder-modal-content">
    <div class="modal-header">
        <h3 id="modal-title">Chọn linh kiện</h3>
        <button class="modal-close" id="close-modal">×</button>
    </div>
    <div class="modal-body-split">
        <aside class="filter-panel">
            <div class="filter-scroll">
                <div class="filter-group">
                    <div class="fg-title">Tìm kiếm</div>
                    <input type="text" id="part-search" placeholder="Tìm theo tên / socket / chuẩn..." />
                </div>
                <div class="filter-group" id="group-facet" style="display:none;">
                    <div class="fg-title" id="facet-title">Thuộc tính</div>
                    <select id="part-filter-socket" class="hidden"></select>
                </div>
                <div class="filter-group brand-filter" id="brand-filter" style="display:none;">
                    <div class="fg-title">Hãng</div>
                    <label class="chk"><input type="checkbox" value="AMD"> <span>AMD</span></label>
                    <label class="chk"><input type="checkbox" value="Intel"> <span>Intel</span></label>
                </div>
            </div>
        </aside>
        <div class="parts-area">
            <div class="parts-grid" id="parts-grid"></div>
        </div>
    </div>
  </div>
</div>

<!-- Footer -->
<div id="footer-container"></div>

<!-- Snackbar xác nhận lắp ráp sẵn -->
<div id="snackbar-buildpc" style="display:none;position:fixed;left:50%;bottom:32px;transform:translateX(-50%);z-index:9999;min-width:320px;max-width:90vw;padding:18px 24px;border-radius:14px;box-shadow:0 4px 32px #00e6ff55,0 2px 12px #0008;display:flex;align-items:center;gap:16px;font-size:1.1rem;backdrop-filter:blur(2px);">
    <span style="flex:1">Bạn có muốn chúng tôi lắp ráp sẵn cho bạn không?</span>

    <!-- Actions trong snackbar/minibar khi thêm vào giỏ -->
    <div id="snackbar-buildpc-actions" class="snackbar-actions" style="display:flex; gap:8px; flex-wrap:wrap;">
        <button id="snackbar-add-bundle" class="btn neon-btn">
            <i class="fa fa-screwdriver-wrench"></i> Lắp ráp sẵn
        </button>
        <button id="snackbar-add-each" class="btn neon-btn alt">
            <i class="fa fa-plus-circle"></i> Từng linh kiện
        </button>
        <button id="cancel-build" class="btn neon-btn alt" type="button" title="Hủy thao tác">
            <i class="fa fa-times"></i> Hủy
        </button>
    </div>
</div>

<script>
// Align chat bar just above builder float bar dynamically
function positionChatLaunch(){
    const floatBar=document.getElementById('builder-float-bar');
    const launchBtn=document.getElementById('openChatbox');
    const root=document.documentElement;
    if(floatBar){
        const h=floatBar.offsetHeight||56;
        // đặt đúng bằng chiều cao thanh dưới -> sát không có khoảng trống
        root.style.setProperty('--chat-launch-bottom', h+'px');
    }
    if(launchBtn){
        root.style.setProperty('--chat-launch-height', launchBtn.offsetHeight+'px');
    }
}
window.addEventListener('resize', positionChatLaunch);
document.addEventListener('DOMContentLoaded', positionChatLaunch);
</script>
<div id="webchat-container" style="position: relative; width: 100%; height: 100%;">


    <!-- Botpress Webchat -->
    <script src="https://cdn.botpress.cloud/webchat/v3.3/inject.js"></script>
    <script src="https://files.bpcontent.cloud/2025/09/11/16/20250911163455-WV71YLDB.js" defer></script>


</div>

<script>
    // Gán sự kiện cho các nút trong snackbar (3 nút: Lắp ráp sẵn, Từng linh kiện, Hủy)
    document.addEventListener('DOMContentLoaded', function() {
        var snackbar = document.getElementById('snackbar-buildpc');
        var btnBundle = document.getElementById('snackbar-add-bundle');
        var btnEach   = document.getElementById('snackbar-add-each');
        var btnCancel = document.getElementById('cancel-build');

        function closeSnack() {
            if (!snackbar) return;
            snackbar.classList.remove('show');
            setTimeout(() => { snackbar.style.display = 'none'; }, 200);
        }

        if (btnBundle) {
            btnBundle.addEventListener('click', function() {
                if (typeof addCurrentSelectionToCart === 'function') {
                    addCurrentSelectionToCart({ bundle: true });
                }
                closeSnack();
            });
        }

        if (btnEach) {
            btnEach.addEventListener('click', function() {
                if (typeof addCurrentSelectionToCart === 'function') {
                    addCurrentSelectionToCart({ bundle: false });
                }
                closeSnack();
            });
        }

        if (btnCancel) {
            btnCancel.addEventListener('click', function() {
                closeSnack();
            });
        }
    });
</script>
<style>
#snackbar-buildpc {
  opacity:0;
  pointer-events:none;
  transition:opacity .3s, bottom .3s, box-shadow .3s;
  background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
  border: 2px solid #00e6ff;
  box-shadow: 0 4px 32px #00e6ff55, 0 2px 12px #0008;
  color: #fff;
}
#snackbar-buildpc.show {
  opacity:1;
  pointer-events:auto;
  bottom:48px;
  box-shadow: 0 0 16px 4px #00e6ffcc, 0 4px 32px #00e6ff55, 0 2px 12px #0008;
}
#snackbar-buildpc .btn {
  font-size:1rem;
  padding:6px 16px;
  background: linear-gradient(90deg, #00e6ff 0%, #0072ff 100%);
  color: #222;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  box-shadow: 0 2px 8px #00e6ff33;
  transition: background .2s, color .2s;
}
#snackbar-buildpc .btn.alt {
  background: #222;
  color: #00e6ff;
  border: 1px solid #00e6ff;
}
#snackbar-buildpc .btn:hover {
  filter: brightness(1.1);
  color: #0072ff;
}
#notification.notification-popup {
  position: fixed;
  right: 16px;
  bottom: 16px;
  min-width: 180px;
  max-width: 320px;
  background: #222;
  color: #fff;
  padding: 10px 16px;
  border-radius: 8px;
  box-shadow: 0 2px 12px #0006;
  z-index: 99999;
  font-size: 0.98rem;
  display: block;
  opacity: 1;
  transition: opacity .3s, bottom .3s;
}
#notification.notification-popup.error { background: #b71c1c; color: #fff; }
#notification.notification-popup.success { background: #222; color: #fff; }
#notification .notification-content { display: flex; align-items: center; gap: 8px; }
#notification .notification-message { flex: 1; }
#notification .notification-close { background: none; border: none; color: #fff; font-size: 1.1em; cursor: pointer; }
#notification .notification-actions { margin-top: 6px; display: flex; gap: 6px; }
#notification .view-cart-btn { background: #00e676; color: #222; border: none; border-radius: 5px; padding: 4px 10px; text-decoration: none; font-weight: 600; font-size:0.95em; }
#notification .continue-btn { background: #444; color: #fff; border: none; border-radius: 5px; padding: 4px 10px; font-size:0.95em; }
@keyframes popupNotification {
  from { opacity: 0; bottom: 0; }
  to { opacity: 1; bottom: 16px; }
}
</style>
</body>
</html>